### THIS IS ALPHA VERSION AND IT CAN AND SHOULD BE CHANGED LATER

### instructions format:
```
opcode (1 байт) | arg (2 байта) | arg_value (зависит от контекста)
```

## Bytecode table

### 1. Загрузка констант и переменных
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `LOAD_CONST` | 0x01 | index | Загружает константу из пула констант |
| `LOAD_FAST` | 0x02 | local_index | Загружает локальную переменную |
| `LOAD_GLOBAL` | 0x03 | name_index | Загружает глобальную переменную |
| `LOAD_NAME` | 0x04 | name_index | Загружает переменную по имени (resolves scope) |

### 2. Сохранение переменных
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `STORE_FAST` | 0x10 | local_index | Сохраняет в локальную переменную |
| `STORE_GLOBAL` | 0x11 | name_index | Сохраняет в глобальную переменную |
| `STORE_NAME` | 0x12 | name_index | Сохраняет переменную по имени |

### 3. Арифметические операции
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `BINARY_ADD` | 0x20 | - | Сложение: `b + a` |
| `BINARY_SUB` | 0x21 | - | Вычитание: `b - a` |
| `BINARY_MULT` | 0x22 | - | Умножение: `b * a` |
| `BINARY_DIV` | 0x23 | - | Деление: `b / a` |
| `BINARY_MOD` | 0x24 | - | Остаток: `b % a` |
todo continue for inplace operations and // operation

### 4. Операции сравнения
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `COMPARE_OP` | 0x30 | cmp_op | Сравнение: `b cmp_op a` |

Коды сравнений:
- 0: `==`
- 1: `!=` 
- 2: `<`
- 3: `<=`
- 4: `>`
- 5: `>=`

### 5. Логические операции
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `UNARY_NOT` | 0x40 | - | Логическое НЕ: `not a` |
| `BINARY_AND` | 0x41 | - | Логическое И: `b and a` |
| `BINARY_OR` | 0x42 | - | Логическое ИЛИ: `b or a` |

### 6. Управление потоком
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `POP_JUMP_IF_FALSE` | 0x50 | target | Переход если ложь |
| `POP_JUMP_IF_TRUE` | 0x51 | target | Переход если истина |
| `JUMP_FORWARD` | 0x52 | delta | Безусловный переход вперед |
| `JUMP_ABSOLUTE` | 0x53 | target | Абсолютный переход |
| `SETUP_LOOP` | 0x54 | delta | Начало блока цикла |

### 7. Функции
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `CALL_FUNCTION` | 0x60 | arg_count | Вызов функции |
| `RETURN_VALUE` | 0x61 | - | Возврат из функции |
| `MAKE_FUNCTION` | 0x62 | flags | Создание функции |

### 8. Работа с массивами
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `BUILD_ARRAY` | 0x70 | count | Создание массива |
| `BINARY_SUBSCR` | 0x71 | - | Индексация: `array[index]` |
| `STORE_SUBSCR` | 0x72 | - | Присваивание по индексу |

### 9. Операции со стеком
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `POP_TOP` | 0x80 | - | Удаляет верхний элемент стека |
| `DUP_TOP` | 0x81 | - | Дублирует верхний элемент |
| `SWAP` | 0x82 | - | Меняет местами два верхних элемента |

### 10. Прочие операции
| Мнемоника | Код | Аргумент | Описание |
|-----------|-----|-----------|----------|
| `NOP` | 0x00 | - | Пустая операция |

## Примеры байткода

### Пример 1: Простое выражение
```python
# Исходный код: x = 10 + 20
LOAD_CONST     0   # 10
LOAD_CONST     1   # 20  
BINARY_ADD        # Сложение
STORE_FAST     0   # Сохраняем в x
```

### Пример 2: Условное выражение
```python
# if (a > b): 
LOAD_FAST      0   # a
LOAD_FAST      1   # b
COMPARE_OP     4   # > (greater than)
POP_JUMP_IF_FALSE 10  # Переход если false
# then блок
LOAD_CONST     2   # then value
JUMP_FORWARD    5   # Пропускаем else
# else блок  
LOAD_CONST     3   # else value
```

### Пример 3: Вызов функции
```python
# result = add(5, 3)
LOAD_GLOBAL    0   # Функция add
LOAD_CONST     0   # Аргумент 5
LOAD_CONST     1   # Аргумент 3
CALL_FUNCTION  2   # Вызов с 2 аргументами
STORE_FAST     0   # Сохраняем результат
```
